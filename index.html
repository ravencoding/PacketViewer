<!DOCTYPE html>
<head xmlns="http://www.w3.org/1999/html">
    <meta charset="utf-8">
    <title>パケットビューア</title>
</head>

<body>
<h1>パケットビューア</h1>
<input type="text" id="packet" ></textarea>
<button id="analyze"/>analyze!</button>
<br />
<br />
<table width="80%" height="200" border="1">
    <tr>
        <th colspan="4">パケットビューワ</th>
    </tr>
    <tr>
        <td>バージョン(4) => <Nobr id="0"></Nobr></td>
        <td>ヘッダ長(4) => <Nobr id="1"></Nobr></td>
        <td>サービスタイプ(8) => <Nobr id="2"></Nobr></td>
        <td>パケット長(5) => <Nobr id="3"></Nobr></td>
    </tr>
    <tr>
        <td colspan="2">識別子(16) => <Nobr id="4"></Nobr></td>
        <td>フラグ(16) => <Nobr id="5"></Nobr></td>
    </tr>
    <tr>
        <td>TTL(8) => <Nobr id="6"></Nobr></td>
        <td>プロトコル番号(8) => <Nobr id="7"></Nobr></td>
        <td colspan="2">ヘッダチェックサム(16) => <Nobr id="8"></Nobr></td>
    </tr>
    <tr>
        <td colspan="4">送信元IPアドレス(32) => <Nobr id="9"></Nobr> => <Nobr id="srcip"></Nobr></td>
    </tr>
    <tr>
        <td colspan="4">宛先IPアドレス(32) => <Nobr id="10"></Nobr> => <Nobr id="destip"></Nobr></td>
    </tr>
    <tr>
        <td colspan="4">オプション(32 × n) => <Nobr id="11"></Nobr></td>
    </tr>
    <tr>
        <td colspan="4">データ本体 => <Nobr id="12"></Nobr></td>
    </tr>

<a>備考: <Nobr id="protocol"></Nobr></a>
</table>
<script type="text/javascript">
    var e = document.getElementById("analyze");
    var packet = document.getElementById("packet");
    var srcip = document.getElementById("srcip");
    var destip = document.getElementById("destip");
    var protocol = document.getElementById("protocol");
    var ans = new Array(13);
    for(var i=0; i<13; i++){
        ans[i] = document.getElementById(i);
    }
    //alert(ans[0]);


    var ary = new Array(32*7);// = new int[32*7];
    var rule = [1,1,2,4,4,4,2,2,4,8,8,8,8];//kihonNoRule
    e.onclick = function(){
        //alert(packet.value.length);
        if(packet.value.length>=60){//KihonNoRUle
            var st = packet.value;

            var update = 0;
            for(var i=0; i<rule.length; i++){
                ary[i] = st.substr(update, rule[i]);
                update += rule[i];
                console.log(ary[i]);
                ans[i].innerHTML = ary[i];
            }
            ans[12].innerHTML=st.substr(0,60)+"<br/>"+st.substring(60,120)+"<br/>"+st.substring(120,180)+"<br/>"+st.substring(180,st.length);

            var srctmp="";
            for(var i=0; i<8;i+=2){
                srctmp += parseInt(ary[9].substr(i, 2), 16);//16進数=>10進数
                if(i<6)srctmp+=".";
            }
            srcip.innerHTML=srctmp;

            var desttmp="";
            for(var i=0; i<8;i+=2){
                desttmp+=parseInt(ary[10].substr(i, 2), 16);//16進数=>10進数
                if(i<6)desttmp+=".";
            }
            destip.innerHTML=desttmp;


            switch(parseInt(ary[7], 16)){
                case 1:
                    protocol.innerHTML="ICMPパケットです";
                    break;
                case 6:
                    protocol.innerHTML="TCPパケットです";
                    break;
                case 17:
                    protocol.innerHTML="UDPパケットです";
                    break;
                default ://未対応の場合
                    protocol.innerHTML="未対応です";
                    break;
            }



        }else alert("NotPacket!");
    }
</script>

</body>
</html>